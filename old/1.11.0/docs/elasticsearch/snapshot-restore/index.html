<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Take and Restore Snapshots - Open Distro for Elasticsearch Documentation</title> <link rel="shortcut icon" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135423944-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-135423944-1'); </script> <script type="text/javascript" src="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Take and Restore Snapshots | Open Distro for Elasticsearch Documentation</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Take and Restore Snapshots" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more." /> <meta property="og:description" content="Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more." /> <link rel="canonical" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/snapshot-restore/" /> <meta property="og:url" content="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/snapshot-restore/" /> <meta property="og:site_name" content="Open Distro for Elasticsearch Documentation" /> <script type="application/ld+json"> {"description":"Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more.","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/images/logo.svg"}},"url":"https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/snapshot-restore/","headline":"Take and Restore Snapshots","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script> <!-- SiteCatalyst code version: H.25.1. Copyright 1996-2012 Adobe, Inc. All Rights Reserved --> <script><!-- /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/ var s_code=s.t();if(s_code)document.write(s_code)//--></script> <script language="JavaScript" type="text/javascript"><!-- if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-') //--></script> <noscript> <img src="//amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazonalldev2/1/H.25.1--NS/0" height="1" width="1" border="0" alt="" /> </noscript> <!--/DO NOT REMOVE/--> <!-- End SiteCatalyst code version: H.25.1. --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/version-history/" class="nav-list-link">Version History</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/" class="nav-list-link">Install and Configure</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/docker/" class="nav-list-link">Docker</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/rpm/" class="nav-list-link">RPM</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/deb/" class="nav-list-link">Debian Package</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/helm/" class="nav-list-link">Helm</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/tar/" class="nav-list-link">Tarball</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/windows/" class="nav-list-link">Windows</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/docker-security/" class="nav-list-link">Docker Security Configuration</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/plugins/" class="nav-list-link">Standalone Elasticsearch Plugin Install</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/ami/" class="nav-list-link">Amazon Machine Image</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/other-components/" class="nav-list-link">Other Components</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/encryption-at-rest/" class="nav-list-link">Encryption at Rest</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/" class="nav-list-link">Upgrade</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-0-0/" class="nav-list-link">Upgrade to 1.x.x</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-11.0/" class="nav-list-link">Upgrade to 1.11.0</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-10-1/" class="nav-list-link">Upgrade to 1.10.1</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-8-0/" class="nav-list-link">Upgrade to 1.8.0</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/rolling/" class="nav-list-link">Rolling Upgrade</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/cluster-restart/" class="nav-list-link">Cluster Restart Upgrade</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/docker/" class="nav-list-link">Docker Upgrade</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/" class="nav-list-link">Elasticsearch</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/configuration/" class="nav-list-link">Configuration</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/cluster/" class="nav-list-link">Cluster Formation</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-data/" class="nav-list-link">Index Data</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-alias/" class="nav-list-link">Index Aliases</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-templates/" class="nav-list-link">Index Templates</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/reindex-data/" class="nav-list-link">Reindex Data</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/catapis/" class="nav-list-link">CAT API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/term/" class="nav-list-link">Term-Level Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/full-text/" class="nav-list-link">Full-Text Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/search-template/" class="nav-list-link">Search Templates</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/bool/" class="nav-list-link">Boolean Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/ux/" class="nav-list-link">Search Experience</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/logs/" class="nav-list-link">Logs</a></li><li class="nav-list-item active"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/snapshot-restore/" class="nav-list-link active">Take and Restore Snapshots</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/units/" class="nav-list-link">Supported Units</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/common-parameters/" class="nav-list-link">Common REST Parameters</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/popular-api/" class="nav-list-link">Popular APIs</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/rest-api-reference/" class="nav-list-link">REST API Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/" class="nav-list-link">Kibana</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/plugins/" class="nav-list-link">Standalone Kibana Plugin Install</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/maptiles/" class="nav-list-link">WMS Map Server</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/" class="nav-list-link">Security</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/concepts/" class="nav-list-link">Authentication flow</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/configuration/" class="nav-list-link">Backend Configuration</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/yaml/" class="nav-list-link">YAML Files</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/tls/" class="nav-list-link">TLS Certificates</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/generate-certificates/" class="nav-list-link">Generate Certificates</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/security-admin/" class="nav-list-link">Apply Changes with securityadmin.sh</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/ldap/" class="nav-list-link">Active Directory and LDAP</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/saml/" class="nav-list-link">SAML</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/openid-connect/" class="nav-list-link">OpenID Connect</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/proxy/" class="nav-list-link">Proxy-based authentication</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/disable/" class="nav-list-link">Disable Security</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/" class="nav-list-link">Access Control</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/users-roles/" class="nav-list-link">Users and Roles</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/document-level-security/" class="nav-list-link">Document-Level Security</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/field-level-security/" class="nav-list-link">Field-Level Security</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/field-masking/" class="nav-list-link">Field Masking</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/impersonation/" class="nav-list-link">User Impersonation</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/multi-tenancy/" class="nav-list-link">Kibana Multi-Tenancy</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/cross-cluster-search/" class="nav-list-link">Cross-Cluster Search</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/permissions/" class="nav-list-link">Permissions</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/default-action-groups/" class="nav-list-link">Default Action Groups</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/api/" class="nav-list-link">API</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/" class="nav-list-link">Audit Logs</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/field-reference/" class="nav-list-link">Audit Log Field Reference</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/storage-types/" class="nav-list-link">Audit Log Storage Types</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/" class="nav-list-link">Alerting</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/monitors/" class="nav-list-link">Monitors</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/settings/" class="nav-list-link">Management</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/security-roles/" class="nav-list-link">Security Roles</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/cron/" class="nav-list-link">Cron</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/" class="nav-list-link">SQL</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/workbench/" class="nav-list-link">Workbench</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/cli/" class="nav-list-link">SQL CLI</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/basic/" class="nav-list-link">Basic Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/complex/" class="nav-list-link">Complex Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/partiql/" class="nav-list-link">JSON Support</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/sql-full-text/" class="nav-list-link">Full-Text Search</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/metadata/" class="nav-list-link">Metadata Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/functions/" class="nav-list-link">Functions</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/window/" class="nav-list-link">Window Functions</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/delete/" class="nav-list-link">Delete</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/endpoints/" class="nav-list-link">Endpoint</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/protocol/" class="nav-list-link">Protocol</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/monitoring/" class="nav-list-link">Monitoring</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/troubleshoot/" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/limitation/" class="nav-list-link">Limitations</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/jdbc/" class="nav-list-link">JDBC Driver</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/odbc/" class="nav-list-link">ODBC Driver</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/" class="nav-list-link">PPL</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/endpoint/" class="nav-list-link">Endpoint</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/protocol/" class="nav-list-link">Protocol</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/commands/" class="nav-list-link">Commands</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/functions/" class="nav-list-link">Functions</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/" class="nav-list-link">Index State Management</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/policies/" class="nav-list-link">Policies</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/managedindices/" class="nav-list-link">Managed Indices</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/api/" class="nav-list-link">ISM API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/refresh-analyzer/" class="nav-list-link">Refresh Search Analyzer</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/knn/" class="nav-list-link">KNN</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/knn/settings/" class="nav-list-link">Settings and Statistics</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/" class="nav-list-link">Anomaly Detection</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/api/" class="nav-list-link">Anomaly Detection API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/cli/" class="nav-list-link">Anomaly Detection CLI</a></li></ul></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/notebooks/" class="nav-list-link">Notebooks</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/" class="nav-list-link">Performance Analyzer</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/dashboards/" class="nav-list-link">Create Dashboards</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/reference/" class="nav-list-link">Metrics Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/" class="nav-list-link">Root Cause Analysis</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/reference/" class="nav-list-link">RCA Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/" class="nav-list-link">Troubleshoot</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/tls/" class="nav-list-link">Troubleshoot TLS</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/saml/" class="nav-list-link">Troubleshoot SAML</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/openid-connect/" class="nav-list-link">Troubleshoot OpenID Connect</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/security-admin/" class="nav-list-link">Troubleshoot securityadmin.sh</a></li></ul></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/other/" class="nav-list-link">Other Resources</a></li></ul> </nav> <footer class="site-footer"> <p class="text-small text-grey-dk-100">See a problem? Submit <a href="https://github.com/opendistro/for-elasticsearch-docs/issues">issues</a> or <a href="https://github.com/opendistro/for-elasticsearch-docs/edit/master/docs/elasticsearch/snapshot-restore.md">edit this page</a> on <a href="https://github.com/opendistro/for-elasticsearch-docs">GitHub</a>.</p> <p class="text-small text-grey-dk-100 mb-0">© 2020 Amazon Web Services, Inc. or its affiliates. All rights reserved.</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search..." aria-label="Search Open Distro for Elasticsearch Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://opendistro.github.io/for-elasticsearch/" class="site-button" > Open Distro for Elasticsearch home </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/">Elasticsearch</a></li> <li class="breadcrumb-nav-list-item"><span>Take and Restore Snapshots</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="take-and-restore-snapshots">Take and restore snapshots</h1> <p>Snapshots are backups of a cluster’s indices and <em>state</em>. State includes cluster settings, node information, index settings, and shard allocation.</p> <p>Snapshots have two main uses:</p> <ul> <li> <p>Recovering from failure</p> <p>For example, if cluster health goes red, you might restore the red indices from a snapshot.</p> </li> <li> <p>Migrating from one cluster to another</p> <p>For example, if you are moving from a proof-of-concept to a production cluster, you might take a snapshot of the former and restore it on the latter.</p> </li> </ul> <hr /> <h4 id="table-of-contents">Table of contents</h4> <ol id="markdown-toc"> <li><a href="#about-snapshots" id="markdown-toc-about-snapshots">About snapshots</a></li> <li><a href="#register-repository" id="markdown-toc-register-repository">Register repository</a> <ol> <li><a href="#shared-file-system" id="markdown-toc-shared-file-system">Shared file system</a></li> <li><a href="#amazon-s3" id="markdown-toc-amazon-s3">Amazon S3</a></li> </ol> </li> <li><a href="#take-snapshots" id="markdown-toc-take-snapshots">Take snapshots</a></li> <li><a href="#restore-snapshots" id="markdown-toc-restore-snapshots">Restore snapshots</a> <ol> <li><a href="#conflicts-and-compatibility" id="markdown-toc-conflicts-and-compatibility">Conflicts and compatibility</a></li> </ol> </li> <li><a href="#security-plugin-considerations" id="markdown-toc-security-plugin-considerations">Security plugin considerations</a></li> </ol> <hr /> <h2 id="about-snapshots">About snapshots</h2> <p>Snapshots are not instantaneous; they take time to complete and do not represent perfect point-in-time views of the cluster. While a snapshot is in-progress, you can still index documents and make other requests to the cluster, but new documents (and updates to existing documents) generally aren’t included in the snapshot. The snapshot includes primary shards as they existed when Elasticsearch initiated the snapshot. Depending on the size of your snapshot thread pool, different shards might be included in the snapshot at slightly different times.</p> <p>Elasticsearch snapshots are incremental, meaning that they only store data that has changed since the last successful snapshot. The difference in disk usage between frequent and infrequent snapshots is often minimal.</p> <p>In other words, taking hourly snapshots for a week (for a total of 168 snapshots) might not use much more disk space than taking a single snapshot at the end of the week. Also, the more frequently you take snapshots, the less time they take to complete. Some Elasticsearch users take snapshots as often as every half hour.</p> <p class="tip">If you need to delete a snapshot, be sure to use the Elasticsearch API rather than navigating to the storage location and purging files. Incremental snapshots from a cluster often share a lot of the same data; when you use the API, Elasticsearch only removes data that no other snapshot is using.</p> <h2 id="register-repository">Register repository</h2> <p>Before you can take a snapshot, you have to “register” a snapshot repository. A snapshot repository is really just a storage location: a shared file system, Amazon S3, Hadoop Distributed File System (HDFS), Azure Storage, etc.</p> <h3 id="shared-file-system">Shared file system</h3> <ol> <li> <p>To use a shared file system as a snapshot repository, add it to <code class="highlighter-rouge">elasticsearch.yml</code>:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">path.repo</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/mnt/snapshots"</span><span class="pi">]</span>
</code></pre></div> </div> <p>On the RPM and Debian installs, you can then mount the file system. If you’re using the Docker install, add the file system to each node in <code class="highlighter-rouge">docker-compose.yml</code> before starting the cluster:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">/Users/jdoe/snapshots:/mnt/snapshots</span>
</code></pre></div> </div> </li> <li> <p>Then register the repository using the REST API:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_snapshot/my-fs-repository</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fs"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/mnt/snapshots"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <p>If the request is successful, the response from Elasticsearch is minimal:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> </ol> <p>You probably only need to specify <code class="highlighter-rouge">location</code>, but to summarize the options:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Setting</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">location</td> <td style="text-align: left">The shared file system for snapshots. Required.</td> </tr> <tr> <td style="text-align: left">chunk_size</td> <td style="text-align: left">Breaks large files into chunks during snapshot operations (e.g. <code class="highlighter-rouge">64mb</code>, <code class="highlighter-rouge">1gb</code>), which is important for cloud storage providers and far less important for shared file systems. Default is <code class="highlighter-rouge">null</code> (unlimited). Optional.</td> </tr> <tr> <td style="text-align: left">compress</td> <td style="text-align: left">Whether to compress metadata files. This setting does not affect data files, which might already be compressed (depending on your index settings). Default is <code class="highlighter-rouge">false</code>. Optional.</td> </tr> <tr> <td style="text-align: left">max_restore_bytes_per_sec</td> <td style="text-align: left">The maximum rate at which snapshots restore. Default is 40 MB per second (<code class="highlighter-rouge">40m</code>). Optional.</td> </tr> <tr> <td style="text-align: left">max_snapshot_bytes_per_sec</td> <td style="text-align: left">The maximum rate at which snapshots take. Default is 40 MB per second (<code class="highlighter-rouge">40m</code>). Optional.</td> </tr> <tr> <td style="text-align: left">readonly</td> <td style="text-align: left">Whether the repository is read-only. Useful when migrating from one cluster (<code class="highlighter-rouge">"readonly": false</code> when registering) to another cluster (<code class="highlighter-rouge">"readonly": true</code> when registering). Optional.</td> </tr> </tbody> </table></div> <h3 id="amazon-s3">Amazon S3</h3> <ol> <li> <p>To use an Amazon S3 bucket as a snapshot repository, install the <code class="highlighter-rouge">repository-s3</code> plugin on all nodes:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./bin/elasticsearch-plugin <span class="nb">install </span>repository-s3
</code></pre></div> </div> <p>If you’re using the Docker installation, see <a href="../../install/docker/#customize-the-docker-image">Customize the Docker image</a>. Your <code class="highlighter-rouge">Dockerfile</code> should look something like this:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM amazon/opendistro-for-elasticsearch:1.11.0

ENV AWS_ACCESS_KEY_ID &lt;access-key&gt;
ENV AWS_SECRET_ACCESS_KEY &lt;secret-key&gt;

# Optional
ENV AWS_SESSION_TOKEN &lt;optional-session-token&gt;

RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch repository-s3
RUN /usr/share/elasticsearch/bin/elasticsearch-keystore create

RUN echo $AWS_ACCESS_KEY_ID | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin s3.client.default.access_key
RUN echo $AWS_SECRET_ACCESS_KEY | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin s3.client.default.secret_key

# Optional
RUN echo $AWS_SESSION_TOKEN | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin s3.client.default.session_token
</code></pre></div> </div> <p>After the Docker cluster starts, skip to step 7.</p> </li> <li> <p>Add your AWS access and secret keys to the Elasticsearch keystore:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./bin/elasticsearch-keystore add s3.client.default.access_key
<span class="nb">sudo</span> ./bin/elasticsearch-keystore add s3.client.default.secret_key
</code></pre></div> </div> </li> <li> <p>(Optional) If you’re using temporary credentials, add your session token:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./bin/elasticsearch-keystore add s3.client.default.session_token
</code></pre></div> </div> </li> <li> <p>(Optional) If you connect to the internet through a proxy, add those credentials:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./bin/elasticsearch-keystore add s3.client.default.proxy.username
<span class="nb">sudo</span> ./bin/elasticsearch-keystore add s3.client.default.proxy.password
</code></pre></div> </div> </li> <li> <p>(Optional) Add other settings to <code class="highlighter-rouge">elasticsearch.yml</code>:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">s3.client.default.disable_chunked_encoding</span><span class="pi">:</span> <span class="no">false</span> <span class="c1"># Disables chunked encoding for compatibility with some storage services, but you probably don't need to change this value.</span>
<span class="s">s3.client.default.endpoint</span><span class="pi">:</span> <span class="s">s3.amazonaws.com</span> <span class="c1"># S3 has alternate endpoints, but you probably don't need to change this value.</span>
<span class="s">s3.client.default.max_retries</span><span class="pi">:</span> <span class="m">3</span> <span class="c1"># number of retries if a request fails</span>
<span class="s">s3.client.default.path_style_access</span><span class="pi">:</span> <span class="no">false</span> <span class="c1"># whether to use the deprecated path-style bucket URLs.</span>
<span class="c1"># You probably don't need to change this value, but for more information, see https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html#path-style-access.</span>
<span class="s">s3.client.default.protocol</span><span class="pi">:</span> <span class="s">https</span> <span class="c1"># http or https</span>
<span class="s">s3.client.default.proxy.host</span><span class="pi">:</span> <span class="s">my-proxy-host</span> <span class="c1"># the hostname for your proxy server</span>
<span class="s">s3.client.default.proxy.port</span><span class="pi">:</span> <span class="m">8080</span> <span class="c1"># port for your proxy server</span>
<span class="s">s3.client.default.read_timeout</span><span class="pi">:</span> <span class="s">50s</span> <span class="c1"># the S3 connection timeout</span>
<span class="s">s3.client.default.use_throttle_retries</span><span class="pi">:</span> <span class="no">true</span> <span class="c1"># whether the client should wait a progressively longer amount of time (exponential backoff) between each successive retry</span>
</code></pre></div> </div> </li> <li> <p>If you changed <code class="highlighter-rouge">elasticsearch.yml</code>, you must restart each node in the cluster. Otherwise, you only need to reload secure cluster settings:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST _nodes/reload_secure_settings
</code></pre></div> </div> </li> <li> <p>Create an S3 bucket if you don’t already have one. To take snapshots, you must have permissions to access the bucket. The following IAM policy is an example of those permissions:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"s3:*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"arn:aws:s3:::your-bucket"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"arn:aws:s3:::your-bucket/*"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> <li> <p>Register the repository using the REST API:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_snapshot/my-s</span><span class="mi">3</span><span class="err">-repository</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-s3-bucket"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"base_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my/snapshot/directory"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> </ol> <p>You probably don’t need to specify anything but <code class="highlighter-rouge">bucket</code> and <code class="highlighter-rouge">base_path</code>, but to summarize the options:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Setting</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">base_path</td> <td style="text-align: left">The path within the bucket where you want to store snapshots (e.g. <code class="highlighter-rouge">my/snapshot/directory</code>). Optional. If not specified, snapshots are stored in the bucket root.</td> </tr> <tr> <td style="text-align: left">bucket</td> <td style="text-align: left">Name of the S3 bucket. Required.</td> </tr> <tr> <td style="text-align: left">buffer_size</td> <td style="text-align: left">The threshold beyond which chunks (of <code class="highlighter-rouge">chunk_size</code>) should be broken into pieces (of <code class="highlighter-rouge">buffer_size</code>) and sent to S3 using a different API. Default is the smaller of two values: 100 MB or 5% of the Java heap. Valid values are between <code class="highlighter-rouge">5mb</code> and <code class="highlighter-rouge">5gb</code>. We don’t recommend changing this option.</td> </tr> <tr> <td style="text-align: left">canned_acl</td> <td style="text-align: left">S3 has several <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">canned ACLs</a> that the <code class="highlighter-rouge">repository-s3</code> plugin can add to objects as it creates them in S3. Default is <code class="highlighter-rouge">private</code>. Optional.</td> </tr> <tr> <td style="text-align: left">chunk_size</td> <td style="text-align: left">Breaks files into chunks during snapshot operations (e.g. <code class="highlighter-rouge">64mb</code>, <code class="highlighter-rouge">1gb</code>), which is important for cloud storage providers and far less important for shared file systems. Default is <code class="highlighter-rouge">1gb</code>. Optional.</td> </tr> <tr> <td style="text-align: left">client</td> <td style="text-align: left">When specifying client settings (e.g. <code class="highlighter-rouge">s3.client.default.access_key</code>), you can use a string other than <code class="highlighter-rouge">default</code> (e.g. <code class="highlighter-rouge">s3.client.backup-role.access_key</code>). If you used an alternate name, change this value to match. Default and recommended value is <code class="highlighter-rouge">default</code>. Optional.</td> </tr> <tr> <td style="text-align: left">compress</td> <td style="text-align: left">Whether to compress metadata files. This setting does not affect data files, which depending on your index settings, might already be compressed. Default is <code class="highlighter-rouge">false</code>. Optional.</td> </tr> <tr> <td style="text-align: left">max_restore_bytes_per_sec</td> <td style="text-align: left">The maximum rate at which snapshots restore. Default is 40 MB per second (<code class="highlighter-rouge">40m</code>). Optional.</td> </tr> <tr> <td style="text-align: left">max_snapshot_bytes_per_sec</td> <td style="text-align: left">The maximum rate at which snapshots take. Default is 40 MB per second (<code class="highlighter-rouge">40m</code>). Optional.</td> </tr> <tr> <td style="text-align: left">readonly</td> <td style="text-align: left">Whether the repository is read-only. Useful when migrating from one cluster (<code class="highlighter-rouge">"readonly": false</code> when registering) to another cluster (<code class="highlighter-rouge">"readonly": true</code> when registering). Optional.</td> </tr> <tr> <td style="text-align: left">server_side_encryption</td> <td style="text-align: left">Whether to encrypt snapshot files in the S3 bucket. This setting uses AES-256 with S3-managed keys. See <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/serv-side-encryption.html">Protecting Data Using Server-Side Encryption</a>. Default is false. Optional.</td> </tr> <tr> <td style="text-align: left">storage_class</td> <td style="text-align: left">Specifies the <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html">S3 storage class</a> for the snapshots files. Default is <code class="highlighter-rouge">standard</code>. Do not use the <code class="highlighter-rouge">glacier</code> and <code class="highlighter-rouge">deep_archive</code> storage classes. Optional.</td> </tr> </tbody> </table></div> <h2 id="take-snapshots">Take snapshots</h2> <p>You specify two pieces of information when you create a snapshot:</p> <ul> <li>Name of your snapshot repository</li> <li>Name for the snapshot</li> </ul> <p>The following snapshot includes all indices and the cluster state:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_snapshot/my-repository/</span><span class="mi">1</span><span class="w">
</span></code></pre></div></div> <p>You can also add a request body to include or exclude certain indices or specify some other settings:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_snapshot/my-repository/</span><span class="mi">2</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"indices"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kibana*,my-index*,-my-index-2016"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ignore_unavailable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"include_global_state"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"partial"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Setting</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">indices</td> <td style="text-align: left">The indices that you want to include in the snapshot. You can use <code class="highlighter-rouge">,</code> to create a list of indices, <code class="highlighter-rouge">*</code> to specify an index pattern, and <code class="highlighter-rouge">-</code> to exclude certain indices. Don’t put spaces between items. Default is all indices.</td> </tr> <tr> <td style="text-align: left">ignore_unavailable</td> <td style="text-align: left">If an index from the <code class="highlighter-rouge">indices</code> list doesn’t exist, whether to ignore it rather than fail the snapshot. Default is false.</td> </tr> <tr> <td style="text-align: left">include_global_state</td> <td style="text-align: left">Whether to include cluster state in the snapshot. Default is true.</td> </tr> <tr> <td style="text-align: left">partial</td> <td style="text-align: left">Whether to allow partial snapshots. Default is false, which fails the entire snapshot if one or more shards fails to store.</td> </tr> </tbody> </table></div> <p>If you request the snapshot immediately after taking it, you might see something like:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">_snapshot/my-repository/</span><span class="mi">2</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"snapshots"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nl">"snapshot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6.5.4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"indices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"kibana_sample_data_ecommerce"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"my-index"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"kibana_sample_data_logs"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"kibana_sample_data_flights"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"include_global_state"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IN_PROGRESS"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Note that the snapshot is still in progress. If you want to wait for the snapshot to finish before continuing, add the <code class="highlighter-rouge">wait_for_completion</code> parameter to your request. Snapshots can take a while to complete, though, so consider whether or not this option fits your use case:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT _snapshot/my-repository/3?wait_for_completion=true
</code></pre></div></div> <p>Snapshots have the following states:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">State</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">SUCCESS</td> <td style="text-align: left">The snapshot successfully stored all shards.</td> </tr> <tr> <td style="text-align: left">IN_PROGRESS</td> <td style="text-align: left">The snapshot is currently running.</td> </tr> <tr> <td style="text-align: left">PARTIAL</td> <td style="text-align: left">At least one shard failed to store successfully. Can only occur if you set <code class="highlighter-rouge">partial</code> to <code class="highlighter-rouge">true</code> when taking the snapshot.</td> </tr> <tr> <td style="text-align: left">FAILED</td> <td style="text-align: left">The snapshot encountered an error and stored no data.</td> </tr> <tr> <td style="text-align: left">INCOMPATIBLE</td> <td style="text-align: left">The snapshot is incompatible with the version of Elasticsearch running on this cluster. See <a href="#conflicts-and-compatibility">Conflicts and compatibility</a>.</td> </tr> </tbody> </table></div> <p>You can’t take a snapshot if one is currently in progress. To check:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET _snapshot/_status
</code></pre></div></div> <h2 id="restore-snapshots">Restore snapshots</h2> <p>The first step in restoring a snapshot is retrieving existing snapshots. To see all snapshot repositories:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET _snapshot/_all
</code></pre></div></div> <p>To see all snapshots in a repository:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET _snapshot/my-repository/_all
</code></pre></div></div> <p>Then you can restore a snapshot:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST _snapshot/my-repository/2/_restore
</code></pre></div></div> <p>Just like when taking a snapshot, you can add a request body to include or exclude certain indices or specify some other settings:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">_snapshot/my-repository/</span><span class="mi">2</span><span class="err">/_restore</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"indices"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kibana*,my-index*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ignore_unavailable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"include_global_state"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"include_aliases"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"partial"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rename_pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kibana(.+)"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rename_replacement"</span><span class="p">:</span><span class="w"> </span><span class="s2">"restored-kibana$1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"index_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index.blocks.read_only"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"ignore_index_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"index.refresh_interval"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Setting</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">indices</td> <td style="text-align: left">The indices that you want to restore. You can use <code class="highlighter-rouge">,</code> to create a list of indices, <code class="highlighter-rouge">*</code> to specify an index pattern, and <code class="highlighter-rouge">-</code> to exclude certain indices. Don’t put spaces between items. Default is all indices.</td> </tr> <tr> <td style="text-align: left">ignore_unavailable</td> <td style="text-align: left">If an index from the <code class="highlighter-rouge">indices</code> list doesn’t exist, whether to ignore it rather than fail the restore operation. Default is false.</td> </tr> <tr> <td style="text-align: left">include_global_state</td> <td style="text-align: left">Whether to restore the cluster state. Default is false.</td> </tr> <tr> <td style="text-align: left">include_aliases</td> <td style="text-align: left">Whether to restore aliases alongside their associated indices. Default is true.</td> </tr> <tr> <td style="text-align: left">partial</td> <td style="text-align: left">Whether to allow the restoration of partial snapshots. Default is false.</td> </tr> <tr> <td style="text-align: left">rename_pattern</td> <td style="text-align: left">If you want to rename indices as you restore them, use this option to specify a regular expression that matches all indices you want to restore. Use capture groups (<code class="highlighter-rouge">()</code>) to reuse portions of the index name.</td> </tr> <tr> <td style="text-align: left">rename_replacement</td> <td style="text-align: left">If you want to rename indices as you restore them, use this option to specify the replacement pattern. Use <code class="highlighter-rouge">$0</code> to include the entire matching index name, <code class="highlighter-rouge">$1</code> to include the content of the first capture group, etc.</td> </tr> <tr> <td style="text-align: left">index_settings</td> <td style="text-align: left">If you want to change index settings on restore, specify them here.</td> </tr> <tr> <td style="text-align: left">ignore_index_settings</td> <td style="text-align: left">Rather than explicitly specifying new settings with <code class="highlighter-rouge">index_settings</code>, you can ignore certain index settings in the snapshot and use the cluster defaults on restore.</td> </tr> </tbody> </table></div> <h3 id="conflicts-and-compatibility">Conflicts and compatibility</h3> <p>One way to avoid naming conflicts when restoring indices is to use the <code class="highlighter-rouge">rename_pattern</code> and <code class="highlighter-rouge">rename_replacement</code> options. Then, if necessary, you can use the <code class="highlighter-rouge">_reindex</code> API to combine the two. The simpler way is to delete existing indices prior to restoring from a snapshot.</p> <p>You can use the <code class="highlighter-rouge">_close</code> API to close existing indices prior to restoring from a snapshot, but the index in the snapshot has to have the same number of shards as the existing index.</p> <p>We recommend ceasing write requests to a cluster before restoring from a snapshot, which helps avoid scenarios such as:</p> <ol> <li>You delete an index, which also deletes its alias.</li> <li>A write request to the now-deleted alias creates a new index with the same name as the alias.</li> <li>The alias from the snapshot fails to restore due to a naming conflict with the new index.</li> </ol> <p>Snapshots are only forward-compatible, and only by one major version. For example, snapshots taken on a 2.x cluster can’t be restored on a 1.x cluster or a 6.x cluster, but they <em>can</em> be restored on a 2.x or 5.x cluster.</p> <p>If you have an old snapshot, you can sometimes restore it into an intermediate cluster, reindex all indices, take a new snapshot, and repeat until you arrive at your desired version, but you might find it easier to just manually index your data on the new cluster.</p> <h2 id="security-plugin-considerations">Security plugin considerations</h2> <p>If you are using the security plugin, snapshots have some additional restrictions:</p> <ul> <li>In order to perform snapshot and restore operations, users must have the built-in <code class="highlighter-rouge">manage_snapshots</code> role.</li> <li>You can’t restore snapshots that contain global state or the <code class="highlighter-rouge">.opendistro_security</code> index.</li> </ul> <p>If a snapshot contains global state, you must exclude it when performing the restore. If your snapshot also contains the <code class="highlighter-rouge">.opendistro_security</code> index, either exclude it or list all the other indices that you want to include:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">_snapshot/my-repository/</span><span class="mi">3</span><span class="err">/_restore</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"indices"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-.opendistro_security"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"include_global_state"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The <code class="highlighter-rouge">.opendistro_security</code> index contains sensitive data, so we recommend excluding it when you take a snapshot. If you do need to restore the index from a snapshot, you must include an admin certificate in the request:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">--cert</span> chain.pem <span class="nt">--key</span> kirk.key.pem <span class="nt">-XPOST</span> <span class="s1">'https://localhost:9200/_snapshot/my-repository/3/_restore?pretty'</span>
</code></pre></div></div> </div> </div> <div class="toc"> <ul class="toc-list"> <li class="toc-item"><a href="#about-snapshots">About snapshots</a></li> <li class="toc-item"><a href="#register-repository">Register repository</a></li> <li class="toc-item"><a href="#take-snapshots">Take snapshots</a></li> <li class="toc-item"><a href="#restore-snapshots">Restore snapshots</a></li> <li class="toc-item"><a href="#security-plugin-considerations">Security plugin considerations</a></li> </ul> </div> <div class="search-overlay"></div> </div> <script> anchors.add(); </script> </body> </html>
