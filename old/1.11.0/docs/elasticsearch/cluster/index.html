<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Cluster Formation - Open Distro for Elasticsearch Documentation</title> <link rel="shortcut icon" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135423944-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-135423944-1'); </script> <script type="text/javascript" src="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Cluster Formation | Open Distro for Elasticsearch Documentation</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Cluster Formation" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more." /> <meta property="og:description" content="Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more." /> <link rel="canonical" href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/cluster/" /> <meta property="og:url" content="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/cluster/" /> <meta property="og:site_name" content="Open Distro for Elasticsearch Documentation" /> <script type="application/ld+json"> {"description":"Documentation for Open Distro for Elasticsearch, the community-driven, 100% open source distribution of Elasticsearch with advanced security, alerting, deep performance analysis, and more.","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/assets/images/logo.svg"}},"url":"https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/cluster/","headline":"Cluster Formation","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script> <!-- SiteCatalyst code version: H.25.1. Copyright 1996-2012 Adobe, Inc. All Rights Reserved --> <script><!-- /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/ var s_code=s.t();if(s_code)document.write(s_code)//--></script> <script language="JavaScript" type="text/javascript"><!-- if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-') //--></script> <noscript> <img src="//amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazonalldev2/1/H.25.1--NS/0" height="1" width="1" border="0" alt="" /> </noscript> <!--/DO NOT REMOVE/--> <!-- End SiteCatalyst code version: H.25.1. --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/version-history/" class="nav-list-link">Version History</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/" class="nav-list-link">Install and Configure</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/docker/" class="nav-list-link">Docker</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/rpm/" class="nav-list-link">RPM</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/deb/" class="nav-list-link">Debian Package</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/helm/" class="nav-list-link">Helm</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/tar/" class="nav-list-link">Tarball</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/windows/" class="nav-list-link">Windows</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/docker-security/" class="nav-list-link">Docker Security Configuration</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/plugins/" class="nav-list-link">Standalone Elasticsearch Plugin Install</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/ami/" class="nav-list-link">Amazon Machine Image</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/other-components/" class="nav-list-link">Other Components</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/install/encryption-at-rest/" class="nav-list-link">Encryption at Rest</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/" class="nav-list-link">Upgrade</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-0-0/" class="nav-list-link">Upgrade to 1.x.x</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-11.0/" class="nav-list-link">Upgrade to 1.11.0</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-10-1/" class="nav-list-link">Upgrade to 1.10.1</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/1-8-0/" class="nav-list-link">Upgrade to 1.8.0</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/rolling/" class="nav-list-link">Rolling Upgrade</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/cluster-restart/" class="nav-list-link">Cluster Restart Upgrade</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/upgrade/docker/" class="nav-list-link">Docker Upgrade</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/" class="nav-list-link">Elasticsearch</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/configuration/" class="nav-list-link">Configuration</a></li><li class="nav-list-item active"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/cluster/" class="nav-list-link active">Cluster Formation</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-data/" class="nav-list-link">Index Data</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-alias/" class="nav-list-link">Index Aliases</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/index-templates/" class="nav-list-link">Index Templates</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/reindex-data/" class="nav-list-link">Reindex Data</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/catapis/" class="nav-list-link">CAT API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/term/" class="nav-list-link">Term-Level Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/full-text/" class="nav-list-link">Full-Text Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/search-template/" class="nav-list-link">Search Templates</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/bool/" class="nav-list-link">Boolean Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/ux/" class="nav-list-link">Search Experience</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/logs/" class="nav-list-link">Logs</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/snapshot-restore/" class="nav-list-link">Take and Restore Snapshots</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/units/" class="nav-list-link">Supported Units</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/common-parameters/" class="nav-list-link">Common REST Parameters</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/popular-api/" class="nav-list-link">Popular APIs</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/rest-api-reference/" class="nav-list-link">REST API Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/" class="nav-list-link">Kibana</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/plugins/" class="nav-list-link">Standalone Kibana Plugin Install</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/kibana/maptiles/" class="nav-list-link">WMS Map Server</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/" class="nav-list-link">Security</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/concepts/" class="nav-list-link">Authentication flow</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/configuration/" class="nav-list-link">Backend Configuration</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/yaml/" class="nav-list-link">YAML Files</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/tls/" class="nav-list-link">TLS Certificates</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/generate-certificates/" class="nav-list-link">Generate Certificates</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/security-admin/" class="nav-list-link">Apply Changes with securityadmin.sh</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/ldap/" class="nav-list-link">Active Directory and LDAP</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/saml/" class="nav-list-link">SAML</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/openid-connect/" class="nav-list-link">OpenID Connect</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/proxy/" class="nav-list-link">Proxy-based authentication</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/configuration/disable/" class="nav-list-link">Disable Security</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/" class="nav-list-link">Access Control</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/users-roles/" class="nav-list-link">Users and Roles</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/document-level-security/" class="nav-list-link">Document-Level Security</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/field-level-security/" class="nav-list-link">Field-Level Security</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/field-masking/" class="nav-list-link">Field Masking</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/impersonation/" class="nav-list-link">User Impersonation</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/multi-tenancy/" class="nav-list-link">Kibana Multi-Tenancy</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/cross-cluster-search/" class="nav-list-link">Cross-Cluster Search</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/permissions/" class="nav-list-link">Permissions</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/default-action-groups/" class="nav-list-link">Default Action Groups</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/access-control/api/" class="nav-list-link">API</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/" class="nav-list-link">Audit Logs</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/field-reference/" class="nav-list-link">Audit Log Field Reference</a> </li><li class="nav-list-item "> <a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/security/audit-logs/storage-types/" class="nav-list-link">Audit Log Storage Types</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/" class="nav-list-link">Alerting</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/monitors/" class="nav-list-link">Monitors</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/settings/" class="nav-list-link">Management</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/security-roles/" class="nav-list-link">Security Roles</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/alerting/cron/" class="nav-list-link">Cron</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/" class="nav-list-link">SQL</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/workbench/" class="nav-list-link">Workbench</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/cli/" class="nav-list-link">SQL CLI</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/basic/" class="nav-list-link">Basic Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/complex/" class="nav-list-link">Complex Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/partiql/" class="nav-list-link">JSON Support</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/sql-full-text/" class="nav-list-link">Full-Text Search</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/metadata/" class="nav-list-link">Metadata Queries</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/functions/" class="nav-list-link">Functions</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/window/" class="nav-list-link">Window Functions</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/delete/" class="nav-list-link">Delete</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/endpoints/" class="nav-list-link">Endpoint</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/protocol/" class="nav-list-link">Protocol</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/monitoring/" class="nav-list-link">Monitoring</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/troubleshoot/" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/limitation/" class="nav-list-link">Limitations</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/jdbc/" class="nav-list-link">JDBC Driver</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/sql/odbc/" class="nav-list-link">ODBC Driver</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/" class="nav-list-link">PPL</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/endpoint/" class="nav-list-link">Endpoint</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/protocol/" class="nav-list-link">Protocol</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/commands/" class="nav-list-link">Commands</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ppl/functions/" class="nav-list-link">Functions</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/" class="nav-list-link">Index State Management</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/policies/" class="nav-list-link">Policies</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/managedindices/" class="nav-list-link">Managed Indices</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/settings/" class="nav-list-link">Settings</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/api/" class="nav-list-link">ISM API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ism/refresh-analyzer/" class="nav-list-link">Refresh Search Analyzer</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/knn/" class="nav-list-link">KNN</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/knn/settings/" class="nav-list-link">Settings and Statistics</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/" class="nav-list-link">Anomaly Detection</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/api/" class="nav-list-link">Anomaly Detection API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/ad/cli/" class="nav-list-link">Anomaly Detection CLI</a></li></ul></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/notebooks/" class="nav-list-link">Notebooks</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/" class="nav-list-link">Performance Analyzer</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/dashboards/" class="nav-list-link">Create Dashboards</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/pa/reference/" class="nav-list-link">Metrics Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/" class="nav-list-link">Root Cause Analysis</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/rca/reference/" class="nav-list-link">RCA Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/" class="nav-list-link">Troubleshoot</a><ul class="nav-list "><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/tls/" class="nav-list-link">Troubleshoot TLS</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/saml/" class="nav-list-link">Troubleshoot SAML</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/openid-connect/" class="nav-list-link">Troubleshoot OpenID Connect</a></li><li class="nav-list-item "><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/troubleshoot/security-admin/" class="nav-list-link">Troubleshoot securityadmin.sh</a></li></ul></li><li class="nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/other/" class="nav-list-link">Other Resources</a></li></ul> </nav> <footer class="site-footer"> <p class="text-small text-grey-dk-100">See a problem? Submit <a href="https://github.com/opendistro/for-elasticsearch-docs/issues">issues</a> or <a href="https://github.com/opendistro/for-elasticsearch-docs/edit/master/docs/elasticsearch/cluster.md">edit this page</a> on <a href="https://github.com/opendistro/for-elasticsearch-docs">GitHub</a>.</p> <p class="text-small text-grey-dk-100 mb-0">© 2020 Amazon Web Services, Inc. or its affiliates. All rights reserved.</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search..." aria-label="Search Open Distro for Elasticsearch Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://opendistro.github.io/for-elasticsearch/" class="site-button" > Open Distro for Elasticsearch home </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://opendistro.github.io/for-elasticsearch-docs/old/1.11.0/docs/elasticsearch/">Elasticsearch</a></li> <li class="breadcrumb-nav-list-item"><span>Cluster Formation</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="cluster-formation">Cluster formation</h1> <p>Before diving into Elasticsearch and searching and aggregating data, you first need to create an Elasticsearch cluster.</p> <p>Elasticsearch can operate as a single-node or multi-node cluster. The steps to configure both are, in general, quite similar. This page demonstrates how to create and configure a multi-node cluster, but with only a few minor adjustments, you can follow the same steps to create a single-node cluster.</p> <p>To create and deploy an Elasticsearch cluster according to your requirements, it’s important to understand how node discovery and cluster formation work and what settings govern them.</p> <p>There are many ways that you can design a cluster. The following illustration shows a basic architecture.</p> <p><img src="../../images/cluster.png" alt="multi-node cluster architecture diagram" /></p> <p>This is a four-node cluster that has one dedicated master node, one dedicated coordinating node, and two data nodes that are master-eligible and also used for ingesting data.</p> <p>The following table provides brief descriptions of the node types.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Node type</th> <th style="text-align: left">Description</th> <th style="text-align: left">Best practices for production</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="highlighter-rouge">Master</code></td> <td style="text-align: left">Manages the overall operation of a cluster and keeps track of the cluster state. This includes creating and deleting indices, keeping track of the nodes that join and leave the cluster, checking the health of each node in the cluster (by running ping requests), and allocating shards to nodes.</td> <td style="text-align: left">Three dedicated master nodes in three different zones is the right approach for almost all production use cases. This makes sure your cluster never loses quorum. Two nodes will be idle for most of the time except when one node goes down or needs some maintenance.</td> </tr> <tr> <td style="text-align: left"><code class="highlighter-rouge">Master-eligible</code></td> <td style="text-align: left">Elects one node among them as the master node through a voting process.</td> <td style="text-align: left">For production clusters, make sure you have dedicated master nodes. The way to achieve a dedicated node type is to mark all other node types as false. In this case, you have to mark all the other nodes as not master-eligible.</td> </tr> <tr> <td style="text-align: left"><code class="highlighter-rouge">Data</code></td> <td style="text-align: left">Stores and searches data. Performs all data-related operations (indexing, searching, aggregating) on local shards. These are the worker nodes of your cluster and need more disk space than any other node type.</td> <td style="text-align: left">As you add data nodes, keep them balanced between zones. For example, if you have three zones, add data nodes in multiples of three, one for each zone. We recommend using storage and RAM-heavy nodes.</td> </tr> <tr> <td style="text-align: left"><code class="highlighter-rouge">Ingest</code></td> <td style="text-align: left">Preprocesses data before storing it in the cluster. Runs an ingest pipeline that transforms your data before adding it to an index.</td> <td style="text-align: left">If you plan to ingest a lot of data and run complex ingest pipelines, we recommend you use dedicated ingest nodes. You can also optionally offload your indexing from the data nodes so that your data nodes are used exclusively for searching and aggregating.</td> </tr> <tr> <td style="text-align: left"><code class="highlighter-rouge">Coordinating</code></td> <td style="text-align: left">Delegates client requests to the shards on the data nodes, collects and aggregates the results into one final result, and sends this result back to the client.</td> <td style="text-align: left">A couple of dedicated coordinating-only nodes is appropriate to prevent bottlenecks for search-heavy workloads. We recommend using CPUs with as many cores as you can.</td> </tr> </tbody> </table></div> <p>By default, each node is a master-eligible, data, ingest, and coordinating node. Deciding on the number of nodes, assigning node types, and choosing the hardware for each node type depends on your use case. You must take into account factors like the amount of time you want to hold on to your data, the average size of your documents, your typical workload (indexing, searches, aggregations), your expected price-performance ratio, your risk tolerance, and so on.</p> <p>After you assess all these requirements, we recommend you use a benchmark testing tool like Rally to provision a small sample cluster and run tests with varying workloads and configurations. Compare and analyze the system and query metrics for these tests to design an optimum architecture. To get started with Rally, see the <a href="https://esrally.readthedocs.io/en/stable/">Rally documentation</a>.</p> <p>This page demonstrates how to work with the different node types. It assumes that you have a four-node cluster similar to the preceding illustration.</p> <h2 id="prerequisites">Prerequisites</h2> <p>Before you get started, you must install and configure Elasticsearch on all of your nodes. For information about the available options, see <a href="../../install/">Install and Configure</a>.</p> <p>After you are done, use SSH to connect to each node, and then open the <code class="highlighter-rouge">config/elasticsearch.yml</code> file.</p> <p>You can set all configurations for your cluster in this file.</p> <h2 id="step-1-name-a-cluster">Step 1: Name a cluster</h2> <p>Specify a unique name for the cluster. If you don’t specify a cluster name, it’s set to <code class="highlighter-rouge">elasticsearch</code> by default. Setting a descriptive cluster name is important, especially if you want to run multiple clusters inside a single network.</p> <p>To specify the cluster name, change the following line:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cluster.name: my-application</span>
</code></pre></div></div> <p>to</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">cluster.name</span><span class="pi">:</span> <span class="s">odfe-cluster</span>
</code></pre></div></div> <p>Make the same change on all the nodes to make sure that they’ll join to form a cluster.</p> <h2 id="step-2-set-node-attributes-for-each-node-in-a-cluster">Step 2: Set node attributes for each node in a cluster</h2> <p>After you name the cluster, set node attributes for each node in your cluster.</p> <h4 id="master-node">Master node</h4> <p>Give your master node a name. If you don’t specify a name, Elasticsearch assigns a machine-generated name that makes the node difficult to monitor and troubleshoot.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.name</span><span class="pi">:</span> <span class="s">odfe-master</span>
</code></pre></div></div> <p>You can also explicitly specify that this node is a master node. This is already true by default, but adding it makes it easier to identify the master node:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.master</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div> <p>Then make the node a dedicated master that won’t perform double-duty as a data node:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.data</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <p>Specify that this node will not be used for ingesting data:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.ingest</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <h4 id="data-nodes">Data nodes</h4> <p>Change the name of two nodes to <code class="highlighter-rouge">odfe-d1</code> and <code class="highlighter-rouge">odfe-d2</code>, respectively:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.name</span><span class="pi">:</span> <span class="s">odfe-d1</span>
</code></pre></div></div> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.name</span><span class="pi">:</span> <span class="s">odfe-d2</span>
</code></pre></div></div> <p>You can make them master-eligible data nodes that will also be used for ingesting data:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.master</span><span class="pi">:</span> <span class="no">true</span>
<span class="s">node.data</span><span class="pi">:</span> <span class="no">true</span>
<span class="s">node.ingest</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div> <p>You can also specify any other attributes that you’d like to set for the data nodes.</p> <h4 id="coordinating-node">Coordinating node</h4> <p>Change the name of the coordinating node to <code class="highlighter-rouge">odfe-c1</code>:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.name</span><span class="pi">:</span> <span class="s">odfe-c1</span>
</code></pre></div></div> <p>Every node is a coordinating node by default, so to make this node a dedicated coordinating node, set <code class="highlighter-rouge">node.master</code>, <code class="highlighter-rouge">node.data</code>, and <code class="highlighter-rouge">node.ingest</code> to <code class="highlighter-rouge">false</code>:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.master</span><span class="pi">:</span> <span class="no">false</span>
<span class="s">node.data</span><span class="pi">:</span> <span class="no">false</span>
<span class="s">node.ingest</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <h2 id="step-3-bind-a-cluster-to-specific-ip-addresses">Step 3: Bind a cluster to specific IP addresses</h2> <p><code class="highlighter-rouge">network_host</code> defines the IP address that’s used to bind the node. By default, Elasticsearch listens on a local host, which limits the cluster to a single node. You can also use <code class="highlighter-rouge">_local_</code> and <code class="highlighter-rouge">_site_</code> to bind to any loopback or site-local address, whether IPv4 or IPv6:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">network.host</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">_local_</span><span class="pi">,</span> <span class="nv">_site_</span><span class="pi">]</span>
</code></pre></div></div> <p>To form a multi-node cluster, specify the IP address of the node:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">network.host</span><span class="pi">:</span> <span class="s">&lt;IP address of the node&gt;</span>
</code></pre></div></div> <p>Make sure to configure these settings on all of your nodes.</p> <h2 id="step-4-configure-discovery-hosts-for-a-cluster">Step 4: Configure discovery hosts for a cluster</h2> <p>Now that you’ve configured the network hosts, you need to configure the discovery hosts.</p> <p>Zen Discovery is the built-in, default mechanism that uses <a href="https://en.wikipedia.org/wiki/Unicast">unicast</a> to find other nodes in the cluster.</p> <p>You can generally just add all of your master-eligible nodes to the <code class="highlighter-rouge">discovery.seed_hosts</code> array. When a node starts up, it finds the other master-eligible nodes, determines which one is the master, and asks to join the cluster.</p> <p>For example, for <code class="highlighter-rouge">odfe-master</code> the line looks something like this:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">discovery.seed_hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">&lt;private</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">odfe-d1&gt;"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">&lt;private</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">odfe-d2&gt;"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">&lt;private</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">odfe-c1&gt;"</span><span class="pi">]</span>
</code></pre></div></div> <h2 id="step-5-start-the-cluster">Step 5: Start the cluster</h2> <p>After you set the configurations, start Elasticsearch on all nodes.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start elasticsearch.service
</code></pre></div></div> <p>Then go to the logs file to see the formation of the cluster:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>less /var/log/elasticsearch/odfe-cluster.log
</code></pre></div></div> <p>Perform the following <code class="highlighter-rouge">_cat</code> query on any node to see all the nodes formed as a cluster:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XGET</span> https://&lt;private-ip&gt;:9200/_cat/nodes?v <span class="nt">-u</span> admin:admin <span class="nt">--insecure</span>
</code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip             heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
x.x.x.x           13          61   0    0.02    0.04     0.05 mi        *      odfe-master
x.x.x.x           16          60   0    0.06    0.05     0.05 md        -      odfe-d1
x.x.x.x           34          38   0    0.12    0.07     0.06 md        -      odfe-d2
x.x.x.x           23          38   0    0.12    0.07     0.06 md        -      odfe-c1
</code></pre></div></div> <p>To better understand and monitor your cluster, use the <a href="../catapis/">cat API</a>.</p> <h2 id="advanced-step-6-configure-shard-allocation-awareness-or-forced-awareness">(Advanced) Step 6: Configure shard allocation awareness or forced awareness</h2> <p>If your nodes are spread across several geographical zones, you can configure shard allocation awareness to allocate all replica shards to a zone that’s different from their primary shard.</p> <p>With shard allocation awareness, if the nodes in one of your zones fail, you can be assured that your replica shards are spread across your other zones. It adds a layer of fault tolerance to ensure your data survives a zone failure beyond just individual node failures.</p> <p>To configure shard allocation awareness, add zone attributes to <code class="highlighter-rouge">odfe-d1</code> and <code class="highlighter-rouge">odfe-d2</code>, respectively:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.attr.zone</span><span class="pi">:</span> <span class="s">zoneA</span>
</code></pre></div></div> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.attr.zone</span><span class="pi">:</span> <span class="s">zoneB</span>
</code></pre></div></div> <p>Update the cluster settings:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_cluster/settings</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"cluster.routing.allocation.awareness.attributes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zone"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>You can either use <code class="highlighter-rouge">persistent</code> or <code class="highlighter-rouge">transient</code> settings. We recommend the <code class="highlighter-rouge">persistent</code> setting because it persists through a cluster reboot. Transient settings do not persist through a cluster reboot.</p> <p>Shard allocation awareness attempts to separate primary and replica shards across multiple zones. But, if only one zone is available (such as after a zone failure), Elasticsearch allocates replica shards to the only remaining zone.</p> <p>Another option is to require that primary and replica shards are never allocated to the same zone. This is called forced awareness.</p> <p>To configure forced awareness, specify all the possible values for your zone attributes:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">_cluster/settings</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"cluster.routing.allocation.awareness.attributes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zone"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cluster.routing.allocation.awareness.force.zone.values"</span><span class="p">:[</span><span class="s2">"zoneA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zoneB"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Now, if a data node fails, forced awareness does not allocate the replicas to a node in the same zone. Instead, the cluster enters a yellow state and only allocates the replicas when nodes in another zone come online.</p> <p>In our two-zone architecture, we can use allocation awareness if <code class="highlighter-rouge">odfe-d1</code> and <code class="highlighter-rouge">odfe-d2</code> are less than 50% utilized, so that each of them have the storage capacity to allocate replicas in the same zone. If that is not the case, and <code class="highlighter-rouge">odfe-d1</code> and <code class="highlighter-rouge">odfe-d2</code> do not have the capacity to contain all primary and replica shards, we can use forced awareness. This approach helps to make sure that, in the event of a failure, Elasticsearch doesn’t overload your last remaining zone and lock up your cluster due to lack of storage.</p> <p>Choosing allocation awareness or forced awareness depends on how much space you might need in each zone to balance your primary and replica shards.</p> <h2 id="advanced-step-7-set-up-a-hot-warm-architecture">(Advanced) Step 7: Set up a hot-warm architecture</h2> <p>You can design a hot-warm architecture where you first index your data to hot nodes—fast and expensive—and after a certain period of time move them to warm nodes—slow and cheap.</p> <p>If you analyze time series data that you rarely update and want the older data to go onto cheaper storage, this architecture can be a good fit.</p> <p>This architecture helps save money on storage costs. Rather than increasing the number of hot nodes and using fast, expensive storage, you can add warm nodes for data that you don’t access as frequently.</p> <p>To configure a hot-warm storage architecture, add <code class="highlighter-rouge">temp</code> attributes to <code class="highlighter-rouge">odfe-d1</code> and <code class="highlighter-rouge">odfe-d2</code>, respectively:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.attr.temp</span><span class="pi">:</span> <span class="s">hot</span>
</code></pre></div></div> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">node.attr.temp</span><span class="pi">:</span> <span class="s">warm</span>
</code></pre></div></div> <p>You can set the attribute name and value to whatever you want as long as it’s consistent for all your hot and warm nodes.</p> <p>To add an index <code class="highlighter-rouge">newindex</code> to the hot node:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">newindex</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index.routing.allocation.require.temp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hot"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Take a look at the following shard allocation for <code class="highlighter-rouge">newindex</code>:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">_cat/shards/newindex?v</span><span class="w">
</span><span class="err">index</span><span class="w">     </span><span class="err">shard</span><span class="w"> </span><span class="err">prirep</span><span class="w"> </span><span class="err">state</span><span class="w">      </span><span class="err">docs</span><span class="w"> </span><span class="err">store</span><span class="w"> </span><span class="err">ip</span><span class="w">         </span><span class="err">node</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.225</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">1</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.225</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">1</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.225</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">1</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.225</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">1</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.225</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">1</span><span class="w">
</span><span class="err">new_index</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span></code></pre></div></div> <p>In this example, all primary shards are allocated to <code class="highlighter-rouge">odfe-d1</code>, which is our hot node. All replica shards are unassigned, because we’re forcing this index to allocate only to hot nodes.</p> <p>To add an index <code class="highlighter-rouge">oldindex</code> to the warm node:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">oldindex</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"index.routing.allocation.require.temp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warm"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The shard allocation for <code class="highlighter-rouge">oldindex</code>:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">_cat/shards/oldindex?v</span><span class="w">
</span><span class="err">index</span><span class="w">     </span><span class="err">shard</span><span class="w"> </span><span class="err">prirep</span><span class="w"> </span><span class="err">state</span><span class="w">      </span><span class="err">docs</span><span class="w"> </span><span class="err">store</span><span class="w"> </span><span class="err">ip</span><span class="w">        </span><span class="err">node</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.74</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">2</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.74</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">2</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.74</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">2</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.74</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">2</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="err">p</span><span class="w">      </span><span class="err">STARTED</span><span class="w">       </span><span class="mi">0</span><span class="w">  </span><span class="mi">230</span><span class="err">b</span><span class="w"> </span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.74</span><span class="w"> </span><span class="err">odfe-d</span><span class="mi">2</span><span class="w">
</span><span class="err">old_index</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="err">r</span><span class="w">      </span><span class="err">UNASSIGNED</span><span class="w">
</span></code></pre></div></div> <p>In this case, all primary shards are allocated to <code class="highlighter-rouge">odfe-d2</code>. Again, all replica shards are unassigned because we only have one warm node.</p> <p>A popular approach is to configure your <a href="../index-templates/">index templates</a> to set the <code class="highlighter-rouge">index.routing.allocation.require.temp</code> value to <code class="highlighter-rouge">hot</code>. This way, Elasticsearch stores your most recent data on your hot nodes.</p> <p>You can then use the <a href="../../ism/index/">Index State Management (ISM)</a> plugin to periodically check the age of an index and specify actions to take on it. For example, when the index reaches a specific age, change the <code class="highlighter-rouge">index.routing.allocation.require.temp</code> setting to <code class="highlighter-rouge">warm</code> to automatically move your data from hot nodes to warm nodes.</p> <h2 id="next-steps">Next steps</h2> <p>If you are using the security plugin, the previous request to <code class="highlighter-rouge">_cat/nodes?v</code> might have failed with an initialization error. To initialize the plugin, run <code class="highlighter-rouge">elasticsearch/plugins/opendistro_security/tools/securityadmin.sh</code>. A sample command that uses the demo certificates might look like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./securityadmin.sh <span class="nt">-cd</span> ../securityconfig/ <span class="nt">-icl</span> <span class="nt">-nhnv</span> <span class="nt">-cacert</span> /etc/elasticsearch/root-ca.pem <span class="nt">-cert</span> /etc/elasticsearch/kirk.pem <span class="nt">-key</span> /etc/elasticsearch/kirk-key.pem <span class="nt">-h</span> &lt;private-ip&gt;
</code></pre></div></div> <p>For full guidance around configuration options, see <a href="../../security/configuration">Security configuration</a>.</p> </div> </div> <div class="toc"> <ul class="toc-list"> <li class="toc-item"><a href="#prerequisites">Prerequisites</a></li> <li class="toc-item"><a href="#step-1-name-a-cluster">Step 1: Name a cluster</a></li> <li class="toc-item"><a href="#step-2-set-node-attributes-for-each-node-in-a-cluster">Step 2: Set node attributes for each node in a cluster</a></li> <li class="toc-item"><a href="#step-3-bind-a-cluster-to-specific-ip-addresses">Step 3: Bind a cluster to specific IP addresses</a></li> <li class="toc-item"><a href="#step-4-configure-discovery-hosts-for-a-cluster">Step 4: Configure discovery hosts for a cluster</a></li> <li class="toc-item"><a href="#step-5-start-the-cluster">Step 5: Start the cluster</a></li> <li class="toc-item"><a href="#advanced-step-6-configure-shard-allocation-awareness-or-forced-awareness">(Advanced) Step 6: Configure shard allocation awareness or forced awareness</a></li> <li class="toc-item"><a href="#advanced-step-7-set-up-a-hot-warm-architecture">(Advanced) Step 7: Set up a hot-warm architecture</a></li> <li class="toc-item"><a href="#next-steps">Next steps</a></li> </ul> </div> <div class="search-overlay"></div> </div> <script> anchors.add(); </script> </body> </html>
